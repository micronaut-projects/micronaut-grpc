<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut gRPC</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()"><div style="background-color: color(display-p3 1 0.784 0.2);border-top: 1px solid #000;z-index: 999;font-weight: bold;position:fixed;bottom: 0;left: 0;width: 100%;height: 42px;font-family: -apple-system, 'Helvetica Neue', Helvetica, sans-serif;font-size: 25px;text-align:center;padding-top: 15px;">You are viewing documentation for an old version of <a style="color: #fff !important;" href="https://micronaut-projects.github.io/micronaut-grpc/latest/guide/index.html">Micronaut Grpc</a></div>


<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>3</strong><span>Getting Started</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#server"><strong>4</strong><span>gRPC Server</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#client"><strong>5</strong><span>gRPC Clients</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#serviceDiscovery"><strong>6</strong><span>Service Discovery</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#tracing"><strong>7</strong><span>Distributed Tracing</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#protocolBuffers"><strong>8</strong><span>Protocol Buffers Support</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repository"><strong>9</strong><span>Repository</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-releaseHistory"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-gettingStarted"><a href="#gettingStarted"><strong>3</strong><span>Getting Started</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-server"><a href="#server"><strong>4</strong><span>gRPC Server</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-client"><a href="#client"><strong>5</strong><span>gRPC Clients</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-serviceDiscovery"><a href="#serviceDiscovery"><strong>6</strong><span>Service Discovery</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-tracing"><a href="#tracing"><strong>7</strong><span>Distributed Tracing</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-protocolBuffers"><a href="#protocolBuffers"><strong>8</strong><span>Protocol Buffers Support</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repository"><a href="#repository"><strong>9</strong><span>Repository</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut gRPC</h1>
        <p></p>
        <p>Integration between Micronaut and gRPC</p>
        <p><strong>Version:</strong> <select style='max-width: 200px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option value='https://micronaut-projects.github.io/micronaut-grpc/latest/guide/index.html'>LATEST</option><option value='https://micronaut-projects.github.io/micronaut-grpc/snapshot/guide/index.html'>SNAPSHOT</option><option value='https://micronaut-projects.github.io/micronaut-grpc/4.0.0/guide/index.html'>4.0.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.6.0/guide/index.html'>3.6.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.5.0/guide/index.html'>3.5.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.4.1/guide/index.html'>3.4.1</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.4.0/guide/index.html'>3.4.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.3.1/guide/index.html'>3.3.1</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.3.0/guide/index.html'>3.3.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.2.0/guide/index.html'>3.2.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.1.3/guide/index.html'>3.1.3</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.1.2/guide/index.html'>3.1.2</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.1.1/guide/index.html'>3.1.1</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.1.0/guide/index.html'>3.1.0</option><option selected value='https://micronaut-projects.github.io/micronaut-grpc/3.0.3/guide/index.html'>3.0.3</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.0.2/guide/index.html'>3.0.2</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.0.1/guide/index.html'>3.0.1</option><option value='https://micronaut-projects.github.io/micronaut-grpc/3.0.0/guide/index.html'>3.0.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.5.0/guide/index.html'>2.5.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.4.0/guide/index.html'>2.4.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.3.0/guide/index.html'>2.3.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.2.0/guide/index.html'>2.2.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.1.0/guide/index.html'>2.1.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.0.5/guide/index.html'>2.0.5</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.0.4/guide/index.html'>2.0.4</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.0.3/guide/index.html'>2.0.3</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.0.2/guide/index.html'>2.0.2</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.0.1/guide/index.html'>2.0.1</option><option value='https://micronaut-projects.github.io/micronaut-grpc/2.0.0/guide/index.html'>2.0.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/1.1.0/guide/index.html'>1.1.0</option><option value='https://micronaut-projects.github.io/micronaut-grpc/1.0.1/guide/index.html'>1.0.1</option><option value='https://micronaut-projects.github.io/micronaut-grpc/1.0.0/guide/index.html'>1.0.0</option></select></p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This project allows building <a href="https://grpc.io">gRPC</a> servers and clients with Micronaut.</p>
</div>
<div class="paragraph">
<p>Micronaut adds the following features to the gRPC experience:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compile Time Dependency Injection (DI) and Aspect Oriented Programming (AOP)</p>
</li>
<li>
<p>Service Discovery and Registrations</p>
</li>
<li>
<p>Distributed Tracing</p>
</li>
<li>
<p>Cloud Native Configuration</p>
</li>
</ul>
</div>

<h1 id="releaseHistory"><a class="anchor" href="#releaseHistory"></a>2 Release History</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/releaseHistory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For this project, you can find a list of releases (with release notes) here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-grpc/releases">https://github.com/micronaut-projects/micronaut-grpc/releases</a></p>
</div>

<h1 id="gettingStarted"><a class="anchor" href="#gettingStarted"></a>3 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started you need first create a Micronaut project. The easiest way to do this is with the Micronaut Launch:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <a href="https://micronaut.io/launch/">Micronaut Launch</a></p>
</li>
<li>
<p>Select "gRPC Application" under "Application Type"</p>
</li>
<li>
<p>Choose a Language / Build System etc.</p>
</li>
<li>
<p>Click Generate</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Replace <code>java</code> with <code>kotlin</code> or <code>groovy</code> to change language and the <code>build</code> flag with <code>maven</code> to use Maven instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See also the <a href="https://github.com/micronaut-projects/micronaut-grpc/tree/master/examples">Examples</a> in the repository that provides examples in Java, Kotlin and Groovy.</p>
</div>
<div class="paragraph">
<p>To manually setup gRPC you can create an application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app helloworld</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then follow the below steps depending on the build system chosen.</p>
</div>
<div class="sect2">
<h3 id="_configuring_gradle">Configuring Gradle</h3>
<div class="paragraph">
<p>To configure Gradle, first apply the <code>com.google.protobuf</code> plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">plugins {
    ...
    id 'com.google.protobuf' version '0.8.14'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then configure the gRPC and protobuf plugins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ext {
    protocVersion="3.12.2"
    grpcVersion="1.30.0"
}

sourceSets {
    main {
        java {
            srcDirs 'build/generated/source/proto/main/grpc'
            srcDirs 'build/generated/source/proto/main/java'
        }
    }
}

protobuf {
    protoc { artifact = "com.google.protobuf:protoc:${protocVersion}" }
    plugins {
        grpc { artifact = "io.grpc:protoc-gen-grpc-java:${grpcVersion}" }
    }
    generateProtoTasks {
        all()*.plugins { grpc {} }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use this configuration for Kotlin projects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">ext {
    protocVersion="3.12.2"
    grpcVersion="1.29.0"
    grpcKotlinVersion="0.1.2"
}

dependencies {
...
    implementation("io.grpc:grpc-kotlin-stub:${grpcKotlinVersion}")
}


sourceSets {
    main {
        java {
            srcDirs 'build/generated/source/proto/main/grpc'
            srcDirs 'build/generated/source/proto/main/grpckt'
            srcDirs 'build/generated/source/proto/main/java'
        }
    }
}

protobuf {
    protoc { artifact = "com.google.protobuf:protoc:${protocVersion}" }
    plugins {
        grpc { artifact = "io.grpc:protoc-gen-grpc-java:${grpcVersion}" }
        grpckt { artifact = "io.grpc:protoc-gen-grpc-kotlin:${grpcKotlinVersion}" }
    }
    generateProtoTasks {
        all()*.plugins {
            grpc {}
            grpckt {}
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally add the following dependencies to your build:</p>
</div>
<div class="paragraph">
<p>For gRPC servers:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.grpc:micronaut-grpc-server-runtime:3.0.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.grpc&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-grpc-server-runtime&lt;/artifactId&gt;
    &lt;version&gt;3.0.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>For gRPC clients:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.grpc:micronaut-grpc-client-runtime:3.0.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.grpc&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-grpc-client-runtime&lt;/artifactId&gt;
    &lt;version&gt;3.0.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you wish to use gRPC standalone without the Micronaut HTTP server you should comment out the <code>micronaut-http-server-netty</code> dependency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew generateProto</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate the Java sources from protobuf definitions in <code>src/main/proto</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_maven">Configuring Maven</h3>
<div class="paragraph">
<p>For Maven create a maven project first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mn create-app helloworld --build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then configure the Protobuf plugin appropriately:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;com.github.os72&lt;/groupId&gt;
  &lt;artifactId&gt;protoc-jar-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.6.0.2&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;phase&gt;generate-sources&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;run&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
          &lt;addProtoSources&gt;all&lt;/addProtoSources&gt;
          &lt;includeMavenTypes&gt;direct&lt;/includeMavenTypes&gt;
          &lt;inputDirectories&gt;
            &lt;include&gt;src/main/proto&lt;/include&gt;
          &lt;/inputDirectories&gt;
          &lt;outputTargets&gt;
              &lt;outputTarget&gt;
                      &lt;type&gt;java&lt;/type&gt;
              &lt;/outputTarget&gt;
              &lt;outputTarget&gt;
                      &lt;type&gt;grpc-java&lt;/type&gt;
                      &lt;pluginArtifact&gt;io.grpc:protoc-gen-grpc-java:1.17.1&lt;/pluginArtifact&gt;
              &lt;/outputTarget&gt;
          &lt;/outputTargets&gt;
        &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw generate-sources</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate the Java sources from protobuf definitions in <code>src/main/proto</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_a_protobuf_file">Defining a Protobuf File</h3>
<div class="paragraph">
<p>Once you have the build setup you can define a Protobuf file for your gRPC service. For example:</p>
</div>
<div class="listingblock">
<div class="title">src/main/proto/helloworld.proto</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-protobuf hljs" data-lang="protobuf">// Copyright 2015 The gRPC Authors
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
syntax = "proto3";

option java_multiple_files = true;
option java_package = "helloworld";
option java_outer_classname = "HelloWorldProto";
option objc_class_prefix = "HLW";

package helloworld;

// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings
message HelloReply {
  string message = 1;
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
With the Micronaut 1.1 or above CLI you can generate a service with <code>mn create-grpc-service helloworld</code> which will create the <code>proto</code> file and class that implements the stub.
</td>
</tr>
</table>
</div>
</div>

<h1 id="server"><a class="anchor" href="#server"></a>4 gRPC Server</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/server.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_writing_a_simple_grpc_server">Writing a Simple gRPC Server</h3>
<div class="paragraph">
<p>To implement a gRPC server for the previously defined <code>helloworld.proto</code> definition you first need to generate the Java stubs using Gradle or Maven then create a class that extends from <code>GreeterGrpc.GreeterImplBase</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.grpc.stub.StreamObserver;
import jakarta.inject.Singleton;

@Singleton
public class GreetingEndpoint extends GreeterGrpc.GreeterImplBase { <b class="conum">(1)</b>

    private final GreetingService greetingService;

    <b class="conum">(2)</b>
    public GreetingEndpoint(GreetingService greetingService) {
        this.greetingService = greetingService;
    }

    @Override
    public void sayHello(HelloRequest request, StreamObserver&lt;HelloReply&gt; responseObserver) {
        <b class="conum">(3)</b>
        final String message = greetingService.sayHello(request.getName());
        HelloReply reply = HelloReply.newBuilder().setMessage(message).build();
        responseObserver.onNext(reply);
        responseObserver.onCompleted();
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">import groovy.transform.CompileStatic
import io.grpc.stub.StreamObserver
import jakarta.inject.Singleton

@CompileStatic
@Singleton
class GreetingEndpoint extends GreeterGrpc.GreeterImplBase { <b class="conum">(1)</b>

    final GreetingService greetingService

    <b class="conum">(2)</b>
    GreetingEndpoint(GreetingService greetingService) {
        this.greetingService = greetingService
    }

    @Override
    void sayHello(HelloRequest request, StreamObserver&lt;HelloReply&gt; responseObserver) {
        <b class="conum">(3)</b>
        HelloReply.newBuilder().with {
            message = greetingService.sayHello(request.name)
            responseObserver.onNext(build())
            responseObserver.onCompleted()
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">import jakarta.inject.Singleton

@Singleton <b class="conum">(1)</b>
@Suppress("unused")
class GreetingEndpoint(val greetingService : GreetingService) : GreeterGrpcKt.GreeterCoroutineImplBase() { <b class="conum">(2)</b>
    override suspend fun sayHello(request: HelloRequest): HelloReply {
        <b class="conum">(3)</b>
        val message = greetingService.sayHello(request.name)
        val reply = HelloReply.newBuilder().setMessage(message).build()
        return reply
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class extends from <code>GreeterGrpc.GreeterImplBase</code> and is annotated with <code>jakarta.inject.Singleton</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can dependency inject other beans into the implementation. In this case <code>GreetingService</code> is dependency injected.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>StreamObserver</code> is used to send a response to the client.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_grpc_server">Running the gRPC Server</h3>
<div class="paragraph">
<p>To run the server use the <code>Application</code> class or run <code>./gradlew run</code> for Gradle or <code>./mvnw compile exec:exec</code> for Maven.</p>
</div>
<div class="paragraph">
<p>The server by default runs on port 50051, however you can configure which port the server runs on by setting <code>grpc.server.port</code> to whichever value you wish (a value of <code>${random.port}</code> will use a random port).</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_grpc_server">Configuring the gRPC Server</h3>
<div class="paragraph">
<p>The server can be be configured in a number of different ways. You can use the <code>io.micronaut.grpc.server.GrpcServerConfiguration</code> type to configure any property of gRPC&#8217;s <code>NettyServerBuilder</code> class via <code>application.yml</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the gRPC server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">grpc:
    server:
        port: 8080
        keep-alive-time: 3h
        max-inbound-message-size: 1024
        ssl:
            cert-chain: 'file://path/to/my.cert' <i class="conum" data-value="1"></i><b>(1)</b>
            private-key: 'classpath:my.key' <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load the certificate from <code>/path/to/my.cert</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load the private key from the classpath. The file should be in <code>src/main/resources/my.key</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default the gRPC server will be enabled. To disable the gRPC server, set <code>grpc.server.enabled</code> to false.</p>
</div>
<div class="paragraph">
<p>Alternatively if you prefer programmatic configuration you can write a <code>BeanCreationListener</code> for example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the ServerBuilder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/*
 * Copyright 2017-2019 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.grpc;

import io.grpc.ServerBuilder;
import io.micronaut.context.event.BeanCreatedEvent;
import io.micronaut.context.event.BeanCreatedEventListener;

import jakarta.inject.Singleton;

@Singleton
public class ServerBuilderListener implements BeanCreatedEventListener&lt;ServerBuilder&lt;?&gt;&gt; {
    @Override
    public ServerBuilder&lt;?&gt; onCreated(BeanCreatedEvent&lt;ServerBuilder&lt;?&gt;&gt; event) {
        final ServerBuilder&lt;?&gt; builder = event.getBean();
        builder.maxInboundMessageSize(1024);
        return builder;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_auto_injected_types">Auto Injected Types</h3>
<div class="paragraph">
<p>By default the server will automatically be dependency injected with beans of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.grpc.BindableService</code> - Any services declared as beans</p>
</li>
<li>
<p><code>io.grpc.ServerInterceptor</code> - Any interceptors declared as beans</p>
</li>
<li>
<p><code>io.grpc.ServerTransportFilter</code> - Any transport filters declared as beans</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, by default the server will be setup to use Micronaut&#8217;s I/O executor service.</p>
</div>
<div class="sect3">
<h4 id="_server_interceptor_ordering">Server Interceptor Ordering</h4>
<div class="paragraph">
<p>To produce a consistent and predictable order of execution for server interceptors, it is required
for the <code>io.grpc.ServerInterceptor</code> implementation to do one of the following:</p>
</div>
<div class="listingblock">
<div class="title">Implement <code>io.micronaut.core.order.Ordered</code> interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
public class CustomInterceptor implements ServerInterceptor, Ordered { <i class="conum" data-value="2"></i><b>(2)</b>
    ...

    @Override
    public int getOrder() {
        return 10; <i class="conum" data-value="3"></i><b>(3)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare the server interceptor as a bean to have it registered automatically</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implement <code>Ordered</code> in addition to <code>ServerInterceptor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Provide the specified order of execution in the server interceptor chain</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Wrap with <code>io.micronaut.grpc.server.interceptor.OrderedServerInterceptor</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory <i class="conum" data-value="1"></i><b>(1)</b>
public class ServerInterceptorFactory {

    @Bean <i class="conum" data-value="2"></i><b>(2)</b>
    @Singleton
    public ServerInterceptor customSeverInterceptor() {
        return new OrderedServerInterceptor(new CustomInterceptor(), 10); <i class="conum" data-value="3"></i><b>(3)</b>
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use a <code>@Factory</code> to create an instance of <code>ServerInterceptor</code> bean</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register the created sever interceptor as a bean</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Wrap the <code>CustomInterceptor</code> with <code>OrderedServerInterceptor</code> and provide the <code>order</code> of execution</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The order which is provided will dictate the order of execution of the interceptors when receiving the request message,
and then the order will be reversed when sending the response message.</p>
</div>
<div class="listingblock">
<div class="title">3 interceptors, with respective orders, <code>1</code>, <code>2</code>, and <code>3</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-txt hljs" data-lang="txt">Request -&gt; 1 -&gt; 2 -&gt; 3 -&gt; business logic -&gt; 3 -&gt; 2 -&gt; 1 -&gt; Response</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_health_checks">Health checks</h3>
<div class="paragraph">
<p>If the management dependency (<code>io.micronaut:micronaut-management</code>) is added, then Micronautâ€™s Health Endpoint can be used to expose the health status of the gRPC server.</p>
</div>
<div class="paragraph">
<p>For example, if gRPC is running then the <code>/health</code> endpoint will return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "status": "UP",
  "details": {
     "grpc-server": {
       "name": "your-project-name",
       "status": "UP",
       "details": {
         "host": "localhost",
         "port": 5050
       }
     }
  },
 ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to disable the gRPC server health check while still using the management dependency you can set the property <code>grpc.server.health.enabled</code> to <code>false</code> in your application configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_server">Testing the Server</h3>
<div class="paragraph">
<p>To test the server it is recommended that you use <a href="https://github.com/micronaut-projects/micronaut-test">Micronaut Test</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For detailed instructions on how to setup Micronaut Test for either Spock or JUnit 5 see the <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html">documentation</a> on the subject.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can then define a blocking stub bean in <code>src/test/java</code>. For example:</p>
</div>
<div class="listingblock">
<div class="title">Defining Test Clients</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory
class Clients {
    @Bean
    GreeterGrpc.GreeterBlockingStub blockingStub(
            @GrpcChannel(GrpcServerChannel.NAME) ManagedChannel channel) { <i class="conum" data-value="1"></i><b>(1)</b>
        return GreeterGrpc.newBlockingStub( <i class="conum" data-value="2"></i><b>(2)</b>
                channel
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <code>ManagedChannel</code> is injected that can communicate with the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The generated gRPC client blocking stub is created.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example uses the <code>@GrpcChannel</code> annotation to inject a gRPC <code>ManagedChannel</code> that can communicate with the running server. This channel will be automatically be shutdown when the application shuts down.</p>
</div>
<div class="paragraph">
<p>Now that you have a test client, writing the test becomes trivial:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.grpc.ManagedChannel;
import io.micronaut.context.annotation.*;
import io.micronaut.grpc.annotation.GrpcChannel;
import io.micronaut.grpc.server.GrpcServerChannel;
import io.micronaut.test.annotation.MicronautTest;
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;

import jakarta.inject.Inject;

@MicronautTest <b class="conum">(1)</b>
public class GreetingEndpointTest {

    @Inject
    GreeterGrpc.GreeterBlockingStub blockingStub; <b class="conum">(2)</b>

    @Test
    void testHelloWorld() {
        final HelloRequest request = HelloRequest.newBuilder() <b class="conum">(3)</b>
                                                 .setName("Fred")
                                                 .build();
        assertEquals(
                "Hello Fred",
                blockingStub.sayHello(request)
                            .getMessage()
        );
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The test is annotated with <code>@MicronautTest</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The client stub is injected into the test</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A request is sent and the response asserted.</td>
</tr>
</table>
</div>
</div>

<h1 id="client"><a class="anchor" href="#client"></a>5 gRPC Clients</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/client.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut for gRPC does not create client beans automatically for you. Instead you must expose which client stubs your application needs using a <code>@Factory</code>.</p>
</div>
<div class="paragraph">
<p>You can dependency inject a <code>io.grpc.ManagedChannel</code> into the factory. Each injected <code>io.grpc.ManagedChannel</code> will automatically be shutdown when the application shuts down.</p>
</div>
<div class="sect2">
<h3 id="_configuring_managedchannel_instances">Configuring ManagedChannel Instances</h3>
<div class="paragraph">
<p>The channel can be configured using properties defined under <code>grpc.client</code> by default.</p>
</div>
<div class="paragraph">
<p>For example, if you wish to disable secure communication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">grpc:
    client:
        plaintext: true
        max-retry-attempts: 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Properties under <code>grpc.client</code> are global properties and are the defaults used unless named configuration exists under <code>grpc.channels.[NAME]</code>.</p>
</div>
<div class="paragraph">
<p>Any property of the <code>io.grpc.netty.NettyChannelBuilder</code> type can be configured.</p>
</div>
<div class="paragraph">
<p>Alternatively if you prefer programmatic configuration you can write a <code>BeanCreationListener</code> for example:</p>
</div>
<div class="listingblock">
<div class="title">Configuring the NettyChannelBuilder</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/*
 * Copyright 2017-2019 original authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package io.micronaut.grpc;

import io.grpc.ManagedChannelBuilder;
import io.micronaut.context.event.BeanCreatedEvent;
import io.micronaut.context.event.BeanCreatedEventListener;

import jakarta.inject.Singleton;

@Singleton
public class ManagedChannelBuilderListener implements BeanCreatedEventListener&lt;ManagedChannelBuilder&lt;?&gt;&gt; {
    @Override
    public ManagedChannelBuilder&lt;?&gt; onCreated(BeanCreatedEvent&lt;ManagedChannelBuilder&lt;?&gt;&gt; event) {
        final ManagedChannelBuilder&lt;?&gt; channelBuilder = event.getBean();
        channelBuilder.maxInboundMessageSize(1024);
        return channelBuilder;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_auto_injected_types">Auto Injected Types</h3>
<div class="paragraph">
<p>By default each channel will automatically be dependency injected with beans of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>io.grpc.ClientInterceptor</code> - Any client interceptors declared as beans</p>
</li>
<li>
<p><code>io.grpc.NameResolver</code> - The configured name resolver</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_creating_client_stub_beans">Creating Client Stub Beans</h3>
<div class="paragraph">
<p>The value of the <code>@GrpcChannel</code> annotation can be used to specify the target server, the configuration for which can also be externalized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Factory
class Clients {
    @Singleton
    GreeterGrpc.GreeterStub reactiveStub(
        @GrpcChannel("http://${my.server}:${my.port}")
        ManagedChannel channel) {
        return GreeterGrpc.newStub(
                channel
        );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example requires that <code>my.server</code> and <code>my.port</code> are specified in <code>application.yml</code> (or via environment variables <code>MY_SERVER</code> and <code>MY_PORT</code>). You can also externalize this further into configuration and provide channel specific configuration.</p>
</div>
<div class="paragraph">
<p>For example given the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">grpc:
    channels:
        greeter:
            address: '${my.server}:${my.port}'
            plaintext: true
            max-retry-attempts: 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then define the <code>@GrpcChannel</code> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
GreeterGrpc.GreeterStub reactiveStub(
    @GrpcChannel("greeter")
    ManagedChannel channel) {
    return GreeterGrpc.newStub(
            channel
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ID <code>greeter</code> is used to reference the configuration for <code>grpc.channels.greeter</code>.</p>
</div>
<div class="paragraph">
<p>Using service IDs in this way is the preferred way to setup gRPC clients, because it works nicely with Service Discovery (see the next section).</p>
</div>
</div>

<h1 id="serviceDiscovery"><a class="anchor" href="#serviceDiscovery"></a>6 Service Discovery</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/serviceDiscovery.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When using <code>@GrpcChannel</code> with a service ID without explicitly configuring the address of the service will trigger gRPC&#8217;s <code>NameResolver</code> and attempt to do service discovery.</p>
</div>
<div class="paragraph">
<p>The default strategy for this is to use DNS based discovery. So for example you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GrpcChannel("dns://greeter")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where DNS has been configured to know the address of the <code>greeter</code> service.</p>
</div>
<div class="paragraph">
<p>Alternatively, if you prefer to use a service discovery server then you can use integration with Micronaut service discovery.</p>
</div>
<div class="sect2">
<h3 id="_service_discovery_with_consul">Service Discovery with Consul</h3>
<div class="paragraph">
<p>You can use Micronaut&#8217;s built-in service discovery features with any supported server (Consul and Eureka currently).</p>
</div>
<div class="paragraph">
<p>The way in which this is done is the <a href="https://docs.micronaut.io/latest/guide/index.html#serviceDiscoveryConsul">same as a regular Micronaut service</a>.</p>
</div>
<div class="sect3">
<h4 id="_registering_a_grpc_service_with_consul">Registering a gRPC Service with Consul</h4>
<div class="paragraph">
<p>To register a gRPC service with Consul first add the <code>micronaut-discovery-client</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.micronaut:micronaut-discovery-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-discovery-client&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Then setup Consul correctly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: greeter
consul:
    client:
        registration:
            enabled: true
        defaultZone: "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using Service Discovery, Micronaut will register the service in Consul using the name defined in <code>micronaut.application.name</code>.
If the application also uses an HTTP Server (Netty, Tomcat,&#8230;&#8203;), Micronaut will register the application with the same
name and a different port in Consul. In case you want to use a different name for the gRPC service in Consul:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: greeter <i class="conum" data-value="1"></i><b>(1)</b>
grpc:
    server:
        instance-id: 'hello-grpc' <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The HTTP port will be registered in Consul with the name <code>greeter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The gRPC port will be registered in Consul with the name <code>hello-grpc</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_discoverying_services_via_consul">Discoverying Services via Consul</h4>
<div class="paragraph">
<p>To discovery services via Consul and the Micronaut <code>DiscoveryClient</code> abstraction enable Consul and gRPC service discovery:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">grpc:
    client:
        discovery:
            enabled: true
consul:
    client:
        defaultZone: "${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then use the value <code>greeter</code> to discover the service when injecting the channel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Bean
GreeterGrpc.GreeterStub greeterStub(
    @GrpcChannel("greeter")
    ManagedChannel channel) {
    return GreeterGrpc.newStub(
            channel
    );
}</code></pre>
</div>
</div>
</div>
</div>

<h1 id="tracing"><a class="anchor" href="#tracing"></a>7 Distributed Tracing</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/tracing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>gRPC includes tracing based on OpenCensus, however if you wish to use Micronaut&#8217;s integration with Jaeger or Zipkin you can do so by adding the following dependencies:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut:micronaut-tracing")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-tracing&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtime(<span class="hljs-string">"io.opentracing.contrib:opentracing-grpc:0.2.1")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.opentracing.contrib&lt;/groupId&gt;
    &lt;artifactId&gt;opentracing-grpc&lt;/artifactId&gt;
    &lt;version&gt;0.2.1&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>You then need to <a href="https://docs.micronaut.io/latest/guide/index.html#distributedTracing">configure either Jaeger or Zipkin</a> appropriately.</p>
</div>

<h1 id="protocolBuffers"><a class="anchor" href="#protocolBuffers"></a>8 Protocol Buffers Support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/protocolBuffers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This project also includes a module that adds the ability to encode and decode Protocol buffers messages with the Micronaut HTTP server.</p>
</div>
<div class="paragraph">
<p>To use this add the <code>micronaut-protobuff-support</code> dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.grpc:micronaut-protobuff-support:3.0.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.grpc&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-protobuff-support&lt;/artifactId&gt;
    &lt;version&gt;3.0.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>Micronaut will now support the encoding and decoding requests / responses of type <code>application/x-protobuf</code>.</p>
</div>

<h1 id="repository"><a class="anchor" href="#repository"></a>9 Repository</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-grpc/edit/master/src/main/docs/guide/repository.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can find the source code of this project in this repository:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-grpc">https://github.com/micronaut-projects/micronaut-grpc</a></p>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>